---
layout: post
title: Tcp/IP
date: 2019-05-06 15:35:12
categories:
- [TCP/IP]
tags: TCP/IP
---

# TCP / IP 协议

## 网络基础知识

1. 计算机网络的作用?
   + 提供一种网络形态, 将单用户工作模式,转化为多用户信息共享, 互联模式;
2. 分时系统
   + 通过多个终端与同一计算机相连, 允许多个用户同时操作一台计算机; 通过分时系统, 虚拟的实现了"一人一机";
   + 特性: 独占性
   + 实现方式: 多任务调度
3. 协议
   + 不同计算机之间通信的基本要求;
   + 举例: 人与人交流的语言 -- 中文/ 英语
4. 电路交换和分组交换
   + 网络通信的方式
   + 电路交换：通信双方独占一条线路进行数据传输，其与用户只能等待；
   + 分组交换：通信双方将数组包分组，在一条通信线路上实现多组用户通信；
5. 接收端的数量进行分类
   + 单播: (一年级, 一班的小李)
   + 广播: 同一个链路中相互链接主机间通信( 一年级所有同学 )
   + 多播：特定组内进行的通信; (一年级一班, 一班的所有同学)
   + 任播：特定组内任意一台主机；(一年级一班, 任意一个同学)
6. 传输速率和吞吐量
   + 传输速率：单位时间内传输的数据量，单位是bps；也称之为带宽；
   + 吞吐量：主机间通信过程中实际的传输速率；
     + 衡量CPU处理能力和网络拥塞程度

## OSI 7层参考模型（Open System Interconnection Reference Model）

1. 计算机通信的前提：能上网

   + 网卡：计算机连网的设备

2. OSI 参考模型的作用？

   + OSI协议的作用：让**异构计算机**之间能互相通信；
   + OSI 分层的作用：抽象出每一层的接口，让网络间通信更简单；
   + 同一层之间的通信: 遵循相同的协议; 
+ 上下层之间通信: 调用接口
   
   

| 分层       | 功能                                                         | 硬件设备                                                     |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 应用层     | 针对特定应用的协议<br />邮件协议-->电子邮件                  |                                                              |
| 表示层     | 数据格式转换：转化为网络标准格式                             | 网关：协议翻译, 数据转换；<br />代理服务器                   |
| 会话层     | 通信管理：**决定**何时建立/断开连接<br />采用何种连接方式(TCP/UDP) |                                                              |
| 传输层     | 管理两个通信节点之间的数据传输；<br />实际建立**逻辑**上的通道 | 4-7层交换机：分析收发数据，进行特定处理<br />负载均衡器(窗口大小啥的) |
| 网络层     | **完整**数据包发送，进行数据链路转换(完整行程列表)           | 路由器/３层交换机：分组数据转换<br />                        |
| 数据链路层 | 负责一个**数据段**帧的发送                                   | 网桥/２层交换机：连接两个网络<br />以太网使用：交换集线器hub |
| 物理层     | 将0/1数据转换为不同介质间的信号量进行传送                    | 中继器：信号整形放大,延长网络；<br />中继集线器, 多个端口的中继器 |



## TCP/IP 基础知识 

1. TCP/IP协议
   + ARPANET 指定的协议
   + 网际协议族: 通信必须用到的协议群统称;
2. RFC概念 Request for Comment
   + TCP/IP 由IETF讨论制定, 需要标准化的协议, 被列入RFC文档并在互联网上公布;
   + 标准化流程
     +  RFC提议标准(6 month) -- 草案标准(4 month) -- 标准
3. 互联网 The Internet  /  网际网 Internet
   + ISP Internet server provider : 不同的区域网ISP, 相互连接称互联网
   + NOC network operation connect : 同一个ISP 中不同网络之间的连接
   + IX Internet Exchange: 不同的ISP区域网之间的链接

### TCP/IP 协议分层模型

1. OSI 模型和TCP/IP模型区别

   + OSI模型: 注重**通信协议具备的功能是什么**;
   + TCP/IP : 注重**计算机上实现协议应该开发哪些程序**

   {% asset_img  tcpip.png %}

2. 模式和使用的协议

   + Client --> Server : 使用TCP/IP协议
   + Wed --> Server: 使用HTTP协议

| 属性                         | 分层                                | 功能 / 协议                                                  | 数据单位  |
| ---------------------------- | ----------------------------------- | ------------------------------------------------------------ | --------- |
| 应用程序                     | 应用层(会话层以上)                  | HTTP: 万维网(WWW) web;   数据格式 -- HTML                    | 消息      |
|                              |                                     | SMTP: Email使用(simple mail transfer protocol)               |           |
|                              |                                     | FTP: 文件传输(file...); **建立两个TCP连接**-- 控制和数据     |           |
|                              |                                     | TELENT  SSH 远程连接 (secure shell)(更安全)                  |           |
|                              |                                     | SNMP 网络管理: (simple network management)                   |           |
| 操作系统                     | 传输层                              | 端口号: 标识不同的应用程序                                   | 段        |
|                              |                                     | TCP : 面向连接的传输协议; 有重传机制                         | TCP数据流 |
|                              |                                     | UDP: 面向无连接; 主要用于多播, 广播和视频                    |           |
|                              | 互联网层(网络层)                    | 通过路由器: 实现数据包的分组转发, 实现IP协议                 | 数据报    |
|                              |                                     | IP协议:根据IP地址进行转发分包数据, 不具备重发机制            | (IP UDP)  |
|                              |                                     | ICMP: IP数据包出故障时, 发送异常通知给发送端                 |           |
|                              |                                     | ARP: 从IP地址中解析MAC地址                                   |           |
| 设备驱动程序<br />与网络接口 | 网络接口层<br />(数据链路层) 网卡层 | 根据MAC地址, 通过以太网中的数据链路进行通信<br />驱动程序: 在操作系统和硬件起桥梁作用 | 帧        |
|                              |                                     | WLAN : 无线局域网                                            |           |
|                              |                                     | PPP: 点对点协议                                              |           |
|                              | 物理层                              | 负责数据传输                                                 |           |



### 数据封装

1. 每一层都会加一个首部:

   {% asset_img first.png %}

2. 数据链路层: 除了加首部, 在尾部加包尾, 循环冗余检测

   {% asset_img data.png %}

3. 数据包处理

   + 数据链路层和网络层: 根据协议进行转发;
   + TCP处理: 先检查校验和 -- 序列号 -- 端口号; 
     + 确认数据无误: 发送确认回执

### TCP/IP 抽象模型

+ 抽象为一个送快递模型
  + 发货方: 	云南的小李 
  + 接收方:    北京的张先生
+ 通信双方都会通过TCP/IP的这个过程, 一个是封装数据, 一个是解压数据

1.  传输层

   + 运送给具体的收件人;
   
2. 网络层

   - 从云南到北京 : 要经过哪些其他省份;
   - 相当于一个行程表

3. 数据链路层:  

   + 根据不同的省份划分的区间; 
   + 每个区间采用货车大小不同: 最大传输单元MTU(maximum transmission union)


## 数据链路层

1. 提供直连两个设备之间的通信功能;

2. 网络拓扑结构

   + 网络连接和构成的形态
   + 总线型 ，环形，星型，混合型；

3.  MAC地址 48bit

   + 第一位 和 第二位 

   {% asset_img MAC.png %}

4. 介质型网络传输

   + 共享介质中传递方式: 多个用户采用一条传输线
     + 争用方式: CSMA/CD 载波监听多路访问 + 碰撞检测
     + 令牌传递方式: 每一个用户能占有一段时间
   + 非共享介质: 
     + 通过2层交换机: 与交换机直连, 构建每个用户的独享;
     + 缺点: 交换机故障,所有用户不能通信

### 以太网

1. 以太网: 最具兼容性的一种数据链路;

2. 介质模式: 非共享介质, 冲突检测不在必要, 让网路变得更加高速;

3. 传输速度: 1K = 1000 ,并非二进制的1024;

4. 协议: IEEE 802.11

5. 以太网帧格式

   + 类型(2byte): 代表上一层协议
   + FCS(frame check sequence): 数据帧在传输过程中,收到电子干扰,导致0/1错码, 需要进行检测;

   {% asset_img macfirst.png %}

### 无线通信

1. 使用介质: 电磁波

2. 几种类型:

   
   
   | 分类                        | 技术     |
   | --------------------------- | -------- |
   | 短距离无线                  | RFID     |
   | 无线PAN Person Area Network | Bletooth |
   | 无线LAN Local Area Network  | Wifi     |
   | 无线WAN  Wide Area Network  | 3G, 4G   |

1. 使用协议
   + IEEE802.11 : 定义了无线LAN协议与数据了链路层的一部分;
   + 介质上采用CSMA/CA 

### PPP 协议

1. 与以太网的区别:
   + 纯数据链路层, 与物理层没有任何关系;
   + 仅有PPP协议是无法通信, 需要物理层的支持
2. PPP协议的数据发送:
   + 建立PPP级的连接, 建立以后进行身份认证, 加密 和压缩
     + 应用: 用户使用拨号接入英特网;
   + LCP: link control protocol, 负责建立和断开连接;
   + NCP: network control protocol.  负责IP地址的设置以及TCP/IP首部压缩;
   + PAP: password authentication protocol, 用户身份的认证协议, 
     + 两次握手进行验证, 密码明文传输
   + CHAP: challenge handshake authentication protocol, 
     + 一次性密码,建立连接后定期换密码
3. 数据包大小: 0-1500 byte

### FDDI fiber distributed data interface

1. FDDI: 分布式光纤数据接口;
2. 采用令牌环进行通信

### ATM 

1. ATM: asynchronous(异步) transfer mode : 以信元为单位进行数据连接;
2. 特点:
   + 面向连接的数据链路;
   + 允许同时与多个对端建立通信连接, 时分多路复用技术

## IP协议

+ 提供**尽力服务**, 没有数据包重传机制

1. 网络层和数据链路层关系:

   + 数据链路层: 相当于每一站的车票;
   + 网络层: 从起点到终点的行程安排;
   + 抽象: 只有同时拥有行程表 和每一站的车票, 才能达到终点;

   {% asset_img IPandMac.png %}

2. IP三个模块
   + IP寻址: IP地址, 唯一性和层次性
   + 路由控制: 将分组数据发送到最终目标地址的功能;
   + 数据报: 分包和组包( 路由器进行 )

### IP 地址

1. 作用: 标识主机和路由器, 使用不同的主机之间通信;

2.  IP地址由两部分组成

   + 网络地址: 
     + 互联的每个**段地址**(不同的数据链路)不能重复;
     + 路由器: 包含不同段的网络地址, 数据在不同的网段之间传播
   + 主机地址: 标识**同一个段地址**中的不同主机;

3. 引入子网掩码的IP地址

   + 子网掩码: 由1组成的一个序列, 用于表示网络地址的位数

   + IP地址 /  网络地址的位数
   + CIDR: 路由聚合
     + 减少一位网络地址,增加一位主机地址;
     + 作用: 可以减小路由控制表;

4. IP地址分类: 4类地址

   + 注意四类中**网络地址**的区间

     {% asset_img IPadress.png %}

   + D类地址: 没有主机标识, 全部用于多播(某些组内)

   + 每一类地址的**主机地址个数** 

     ```
     IP个数 = 2^n - 2 
     主机地址全为0: 用作的是网络地址, 
     主机地址全为1: 用作同一个链路之间的广播地址;
     ```

5. IP多播实现:

   +  D类地址 + IGMP(组内控制协议)

   + 224.0.0.0 - 223.255.255.255 多播地址可用范围

6. 全局地址和私有地址

   + 私有地址分为三类: 其主机数 /8 /10 /12;
   + 全局地址: 由ISP进行管理

### 路由控制

+ 路由协议 : 生成路由控制表 , 控制数据包的下一跳, 最终实现IP通信

1. Hop 一跳

   + IP数据包在一个链路区间的传递; 
   + 到达的应该是下一个路由器;

2. 路由控制表

   + 从源主机到目的主机的路由控制表
   + 也就是下一个路由到哪里;

   
   
   | 路由     | 地址                           | 功能                                    |
   | -------- | ------------------------------ | --------------------------------------- |
   | 默认路由 | 0.0.0.0/0  /0 不是表示的主机IP | 路由表中任一地址都能匹配                |
   | 主机路由 | IP地址/32                      | 整个IP地址都参与路由,不通过网络地址路由 |
   | 环回路由 | 127.0.0.1  localhost           | 主机内部路由                            |



### IP 数据报分割与重组

1. IP数据报为什么要进行分包?

   + 不同的数据链路有不同的传输单元MTU;
   + 以太网: (46 - 1500)byte
   + PPP : 1500byte
   + FDDI : 4352; byte
   + ATM: 9180 byte

2. IP数据包分割与重组

   + IP/UDP 数据分割: 路由器完成
   + IP/UDP 数据片重组: 目标主机
   + TCP的数据分割和重组: 由TCP层自己完成;

   {% asset_img UDP_DATA.png %}

   {% asset_img tcp_data.png %}

### IPv4 首部

1.  地址格式含义

   {% asset_img ipv4_first.png %}

   
   
   | 名称 ( 32bit一组)                 | 长度 bit               | 值                                                           |
   | --------------------------------- | ---------------------- | ------------------------------------------------------------ |
   | 版本号                            | 0-3(4bit)              | 4 = 0100                                                     |
   | 首部长度 : 首部字节数 5*4 =20     | 4-7(4bit)              | 5 = 0101  前20个字节代表首部                                 |
   | 区分服务: 网络状况                | 8-13 (DSCP) 14-15(ECN) | DSCP: 表示优先度;<br />ECN: 表示网络拥塞                     |
   | 总长度: IP数据包的总长度          | 16-31 (16bit)          | 2^16 = 65535字节; **包含首部长度**                           |
   | **32bit一组**                     |                        |                                                              |
   | 标识:用于分片重建, 记录分片的顺序 | 0-15(16bit)            | 2^16 大小, 分片就递增加1                                     |
   | 标志: 是否可以分片/ 最后一个分片  | 16-18 (3bit)           | 16bit: 0;  <br />17bit: 0--分片; 1--不能分片<br />18bit: 0--最后一个包; 1--中间的包 |
   | 片偏移: 表示IP数据包中的位置      | 19-31(13bit)           | 2^13 (8192)*8 = 65536; 单位是8byte                           |
   | **32bit一组**                     |                        |                                                              |
   | 生存周期: 经过路由器个数          | 0-7 (8bit)             | 2^8:= 255 每经过一个路由器, TTL减1                           |
   | 协议: 表示上层协议TCP/UDP         | 8-15 (16bit)           | TCP = 6 ; UDP = 17                                           |
   | 首部校验和                        | 16-31 (16bit)          | 校验数据包的首部,不校验数据                                  |
   | **32bit一组**                     |                        |                                                              |
| 源地址                            | 0-31                   |                                                              |
   | 目标地址                          | 0-31                   |                                                              |
   



### IPv6

1. IPv6地址大小

   + 128bits
   + 8个 16bit 的字节进行表示;
   + **::** 双冒号 : 表示省略多个0, 只能用一次

2. 包首部

   + 首部40 bytes
   + 路由器不参与分片处理, 直接以最小MTU 1280字节进行发出

3. 地址结构

   {% asset_img ipv6.png %}

### IPv6 首部

1. 地址格式

   {% asset_img ipv6_first.png %}

| 名称(32bit一组)                                     | 长度 bit     | 值                                 |
| --------------------------------------------------- | ------------ | ---------------------------------- |
| 版本: 6                                             | 0-3          | 0110                               |
| 通信量类 = 区分服务                                 | 4-11(8bit)   | 占时没用                           |
| 流标号:  + 源/目的地址  == **判断是同一个数据流**   | 12-31(20bit) | 进行服务质量时, 设置为随机数       |
| **32bit一组**                                       |              |                                    |
| 有效负载长度: 能包含的数据包长度 **不包含首部长度** | 0-15         | 2^16=65535 bytes: 不包含首部       |
| 下一个首部 = 协议                                   | 16-23(8bit)  | 表示上一层协议                     |
| 调数限制 = TTL                                      | 24-31(8bit)  | 可经过的路由器个数, 每进过一个减一 |
| **32bit一组**                                       |              |                                    |
| 源地址                                              | 4个32bit     |                                    |
| 目的地址                                            | 4个32bit     |                                    |
| **32bit一组**                                       |              |                                    |
| IPV6的首部是可以扩展的                              |              |                                    |



## IP 协议相关技术

+ 原因: 仅凭IP地址是无法通信的

### DNS Domain(域) name System

1. 域名解析系统作用:

   + 将域名(主机名) --> 解析为 IP地址(4/6)
   + 例子: 将应用层的网址, 解析为IP地址才能正常访问, 因为IP地址是区分不同主机的标识;

2. 域名的构成和分层

   + 构成：由英文字母 + 点构成

     ```
     piyo.kusa.ac.jp	// jp 根域名
     ```

   + 分层: 根域名 + 第1层域名 + ... + 主机域名

3. 域名服务器: 用于管理域名的主机和相应软件;

   + 每一层都有一个域名服务器;
   + 注册: 每一层的域名服务器都必须注册**根域名服务器的IP地址**
     + 上一层的域名服务器: 注册了下一层的IP地址
     + 原因: 本层没有: 向根域名请求查询, 从**根域名**顺序向下查找

4. DNS查询

   + 工具: 解析器
   + 先在本层的域名服务器查找相关域名; 从**根域名**顺序向下查找

5. DNS解析情况

   + 主机名 --> 检索IP地址: "A类" ---  正常的DNS解析
   + IP地址 --> 检索主机名: "PTR类" ---  IP地址的反向解析

### ARP Adress resolution protocol

1.  IPv4  -- ARP协议:   IPv6 (ICMPv6)
   + 以目标IP地址地址为线索, 定位**下一个**接收数据包的**网络设备**对应的MAC地址;
   + 网络设备: 目的主机, 或者路由器
2. ARP工作机制, 如何获得MAC?
   + ARP 请求(广播) : 携带目标通信的IP地址;
   + ARP 响应: 获取下一个的MAC地址;
3. RARP : Reverse 
   + 从MAC地址定位字节的IP地址;
   + 例子: 嵌入式设备接入网络得到IP地址

### ICMP  Internet control message protocol

1. ICMP :消息协议

   + ICMP的通知消息会使用IP进行发送;

   + 一类: 通知出错原因的 **错误消息**;
   + 另一类: 用于诊断的 **查询消息**;

2. 主要的ICMP消息

   + traceroute应用软件 : 显示数据发送过程中经过了多少个路由

   + ICMP目标不可达消息

     | 错误号 | 错误消息                       | 原因                                          |
     | ------ | ------------------------------ | --------------------------------------------- |
     | 0      | Network Unreachable 网络不可达 | TTL生存周期减到0时, 经过了2^8个路由器, 有错误 |
     | 1      | Host  Unreachable  主机不可达  | 目标主机的IP地址不存在                        |
   
   

   + ICMP回送消息(本地消息)
  + 用途: 用于正在进行通信的主机之间 或者 路由器之间;
     + 作用: 判断数据包是否发送到对端;
     + command: ping IP

3. ICMPv6

   + 用于IPV6中的消息机制
   + 邻居探索: 用于查询IPv6地址与MAC地址对应关系, 并向邻居宣告的得知的MAC地址
     + 实现: 利用多播地址实现传输

### DHCP dynamic host configure protocol

1. DHCP: dynamic host configuration protocal
   - 通过DHCP自动分配获取IP地址
2. DHCP 功能:
   + 实现用互上网的即插即用, 自动获取相应的IP地址;
3. DCHP 如何实现:
   + DHCP client : 广播发送DHCP**发现包**(请求分配IP)
   + DHCP server: 回复DHCP**提供包**(提供能分配的ip)
   + DHCP client: 发送DHCP**请求包**(进行设置)
   + DHCP server: 回复DHCP**提供包**(允许)
4. DHCP client server具备的 功能:
   + server: 在分配IP之前, 发送ICMP**回送请求包**
   + client : 针对获取的IP地址, 发送ARP请求包;
5. DHCP 中继代理
   + 作为客户端和服务器之间的桥梁;
   + 避免每一个客户端都需要与服务器直连

### NAT network address translator

1. NAT作用
   + 在本地网络使用私有地址, 在连接互联网时使用全局地址;
   + 实现一个全局IP与多个主机通信;
2. NAT-PT
   + 在IPv4 和 IPv6  之间通信;

### other

1. IP隧道: 不支持路由器就可以采用这种技术;
2. IGMP: 实现多播技术

## 路由协议

+ 网络层路由器使用的协议: 传输数据报
+ 网路层存在两个网络设备: 主机 + 路由器

1. 路由协议的作用: 
   + 所有的路由协议, 目的都是生成路由信息控制转发表;
2. 路由控制的定义?
   + 根据目的**IP**地址, 构成目的可达的**路由控制转发表**,  使得数据包能按照**正确的方向**转发数据;
3. 路由的分类
   + 静态路由: 手动设置主机和路由器的IP信息;
   + 动态路由: 首先选定**路由协议**, 由自制系统内部的路由生成路由控制信息表

### 动态路由基础

1. 动态路由如何生成路由控制表?
   + 相邻路由会发送已知的网络信息, 像接力赛一样一直传递, 直至整个网络都了解;
2. 路由控制范围?
   + 分为内部和外部: IGP (Interior Gateway protocal) 和 EGP(Exterior Gateway protocal)
   + **抽象对比**:   主机IP地址 + 网络IP地址 
   + 原因: 只有一种存在, 是无法完成数据传递的;
3. 自治系统AS(autonomous system) 和路由选择域?
   + AS 内部采用的协议是IGP域内路由协议;
   + AS 自制系统之间采用的是EGP 域外路由协议;

### 路由算法

1. 距离向量算法

   + 根据**距离( hop 数量)**和**转发方向**决定下一跳的网络设备, 目的是经过**较少路由器**的个数
   + 代价: 不同的转发方向, 决定了不同的距离; 
   
2. 链路状态算法

   + 每个路由都保存整个网络的拓扑结构, 根据**链路代价**进行选择;
   + 代价: 每个链路的权重和

3. 路径向量算法

   + 以AS自治网路的个数进行选择
   + **经过较少的AS**

4. 主要的路由协议

   {% asset_img routing.png %}

### RIP Routing Information Protocol

1. RIP的特点
   + 距离向量型的路由协议: 最少路由器为选择
   + **定期** 和 **广播**交换路由信息;(即使网络状态稳定)
   + 不与子网掩码进行交互;
   + 链路出问题时处理方式:  不确定是哪一个链路出问题就进行**路由控制**, 稳定周期很长
2. RIP如何生成路由控制信息表?
   + 首先: 路由器每30秒为一个周期, 广播已知的路由信息; 等待6个周期后没有反馈则断开网络;
   + 然后: 从距离向量数据库中, 抽出**距离短**的作为新的控制向量表;
3. 路由变更的时候,如何更新?
   + 定期进行广播, 下一个路由在原基础上加1后, 传给下一个路由; ( 要传回发送路由, 不然6个周期认为断开 )
4. RIP如何解决无限计数的问题?
   + 方法一: 定义最长条跳数为16, 超过后还未达到, 认为链路处于断开状态;
   + 方法二: 水平分割, 接收端不把收到的信息返回给发送端;
5. 环路问题的解决?
   + 毒性逆转: 当链路中有断开时, 发送距离为16的消息(网络不可达)
   + 触发更新: 当链路变化时,  为了链路尽快收敛, 不再是定期广播, 而是立刻发送;
6. RIP2
   + 采用多播的形式;

### OSPF open shortest path first

1. OSPF 的特点?

   + 链路状态算法型的路由协议: 以**最小权重代价**进行选择;
   + 路由控制表实现生成: 路由与中心路由交互得到控制信息;
     + 每个路由器都包含整个网络的拓扑结构, 得到最优路径;

2. OSPF 如何得到路由控制表?

   + 首先发送HELLO协议: LAN每10秒发送**hello包**, 确认链路是否处于连接状态
     + 未收到链路状态确认包, 空等3次, 第4次还未收到则确认断开
   + 然后: 链路变化, 如何更新?
     + 发送链路状态**请求包和 更新包**
     + NLSA network link state advertisement : 以网络为中心生成的信息, 与那些路由器相连;
     + RLSA  Routing : 以路由器为中心
   + 最后: 生成网络结构的链路状态信息库;

3. 在AS自治系统内引入**区域**

   + 将路由器划分为5种;

   {% asset_img ospf.png %}

### BGP border gateway protocol

1. BGP的特点?
   + 路径向量的协议;
   + 边界网管协议, 连接不同的AS 自治系统
2. AS路径信息访问列表
   + 包含转发方向和距离(RIP), 还涵盖途经所有AS编号;
   + BGP路由控制表生成?
   + 通过BGP扬声器, 创建BGP链接, 在AS之间交换信息;
   + 得到一个经过AS数量最少的路径

### MPLS multi protocol label switching

1. 特点
   + 多协议标记交换技术;
   + 每个IP包都含有一个标记值

## 传输层 TCP/UDP

1. 传输层的作用?
   
   + 将IP数据包, 发送给具体的应用程序;
   
2. 传输层的标识/抽象 ?
   
   + 端口号 ( 快递中的姓氏 )
   
3. client  and server 如何处理通信过程?
   + client: 向端口号为80的应用程序请求连接
   + server: 服务器程序充当**守护进程**, 接收client的请求;
     + 启动一个可以代表所有守护进程的inetd(超级守护进程);
     + inetd 监听到请求后, 通过fork exec 转换成对应server的守护进程
   + http server --> 守护进程 httpd;
   
4. 能够认为是TCP/IP 通信过程?
   
   + IP(源/目的) + 端口号(源/目的) + 协议
   
5. TCP和UDP的区别总结

   

   | 角度     | TCP                                                 | UDP                                                          |
   | -------- | --------------------------------------------------- | ------------------------------------------------------------ |
   | 连接     | 面向连接（发送数据前需要建立连接）                  | 无连接（发送数据无需连接）                                   |
   | 丢包重试 | 实现了数据传输时各种控制功能:丢包重发控制，顺序控制 | 不会进行丢包重试，也不会纠正到达的顺序                       |
   | 模式     | 流模式（面向字节流）                                | 数据报模式（面向报文）                                       |
   | 对应关系 | 一对一                                              | 支持一对一，一对多，多对一和多对多的交互通信                 |
   | 头部开销 | 最小20字节                                          | 只有8字节                                                    |
   | 可靠性   | 全双工非常可靠、无差错、不丢失、不重复、且按序到达  | 不保证可靠交付，不保证顺序到达                               |
   | 拥塞控制 | 有控制                                              | 有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低（对实时应用很有用，如IP电话，实时视频会议等） |
   | 资源要求 | TCP程序结构较复杂，较多                             | UDP程序结构简单，少                                          |

   

### 端口号

1. 端口号标识符的作用
   + 识别同一台计算机中进行通信的不同应用程序; 
   + 另一个名称: 程序地址;
2. 端口号的定义:  有传输层的协议确定
   + 静态定义: 标准既定的端口号;
     + 50 - DNS ;  http-80 ;  ssh-22
   + 时序分配法: 操作系统进行加1 

### TCP transfer control protocol

1. TCP 传输协议: 可靠的数据流传输协议;
   + 传输, 发送, 通信, 进行控制的协议;
   + 建立通信的虚拟电路
2. 重发超时时间设定
   + 需要动态: 不同LAN 通信距离不同;
   + 时间大小( min 1s) = 传输往返时间(0.5s) + 偏移量(0.5s)
   + 以指数形式增加等待时间; (当TTL为0时就结束)

### TCP 连接和断开 

+ 连接: 3次握手; 
  + **第三次握手**:  确认了TCP数据的最大消息长度MSS;
+ 断开: 4次握手

1. 建立连接目的

   + 以**段**为单位: 确认最大消息长度MSS  maximum segment size
   + 确保消息不会被IP路由分割

   {% asset_img tcp_client.png %}

2. 段数据发送 , 如何增加**吞吐量**?

   + 滑动窗口: 将n个段一起发送, 收到某个段的应答时, 滑动窗口下移;

3. 窗口控制和重发控制?

   + 窗口大小控制 ( 数据流控制 )
     + a)窗口探测机制: 
       + 发送探测字段(1byte), 获取接收方容纳空间, 从而增加窗口大小;
     + b) 拥塞控制:
       + 先设置窗口为1, 当收到ACK确认后, 递增窗口大小;
       + 遇到超时重发时, 设置慢启动阀值, 将拥塞窗口减小为一半;
   + 重发控制: 重发的两种情况
     + ACK确认应答丢失, 此时数据收到; 
       + 无需重发, 只需要确认下一个序列号就行
     + 数据包丢失:  server 重复三次发送同一数据段的确认消息
       + 高速重发机制: client 收到3次确认应答时, 重发数据;
       + 超时重发机制: 以**重发超时**时间进行等待;

4. 提高网络**利用率**?

   + Nagle 算法: 针对 **发送方**
     + 机制: 当发送端数据很少时, **延迟发送**
     + 何时进行数据发送?
       + 已发送数据**都**收到应答时;
       + 发送消息发到最大的MSS;
   + **延迟确认应答** : 接收方
     + 何时发送回复确认:
       + 收到 2* MSS消息段时;
       + 延时发送回复确认, 最大延时0.5秒
   + 捎带应答
     + 启用延迟确认应答机制后, 才能使用;

### TCP 首部

1. TCP首部: 20bytes

   {% asset_img tcp_first.png %}

   
   
   | 名称(32bit为一组)       | 长度 bit | 作用                                                         |
   | ----------------------- | -------- | ------------------------------------------------------------ |
   | 源端口号                | 2^16     | 标识发送端                                                   |
   | 目的端口                | 2^16     | 标识接收端                                                   |
   | 序列号: 发送数据的位置; | 2^32     | 序列号不会从0/1开始, 随机生成,;<br />SYN和FIN 不包含数据,但是会增加一个字节的序列号 |
   | 确认应答号              | 2^32     | 发送方设置: 下一次应该收到的序列号;<br />在这之前的数据确认都被收到了 |
   |                         |          |                                                              |
   | 数据偏移 : 5            | 2^4      | 将首部 和 数据的位置分开, 从第二十的字节后才是数据           |
   | 保留位                  | 2^4      | 0 还未用                                                     |
   | 控制位                  | 2^8      | 每一位使用的时候设置为1<br />ACK = 1 : 用于确认时一直为1<br />SYN = 1: 确认建立连接<br />FIN = 1: 断开连接 |
   | 窗口大小                | 2^16     | 指示发送端从**确认应答号**所指处, 能接受的数据大小(8bit)<br />窗口为0时: 可以发送探测窗口; |
   |                         |          |                                                              |
| 校验和                  | 2^16     | TCP的校验和无法关闭, 和udp一样需要TCP伪首部                  |
   | 紧急长度                | 2^16     | 没有用                                                       |
   
   

### UDP user datagram protocal

1. UDP提供的通信方式

   + 通过IP提供一种无连接的通信服务;

2. UDP的首部: 8byte

   {% asset_img udp_first.png %}

   

   | 名称       | 长度            | 作用                                                         |
   | ---------- | --------------- | ------------------------------------------------------------ |
   | 源端口号   | 2^16长度= 65536 | 设置为0: 不需要返回的通信中                                  |
   | 目的端口号 | 2^16            | 标志计算机通信中不同的应用程序                               |
   | 包长       | 2^16            | UDP首部 + data 总长                                          |
   | 校验和     | 2^16            | 校验和字段在内的所有数据之和 = 16位全为1, 数据是否正确<br />UDP的校验和可以关闭, 减少时间 |



1. **校验和**的计算需要**UDP伪首部**
   + UDP的伪首部概念: 标识一个TCP/IP通信需要5各部分, IP(源/目的) + port(源/目的) + 协议;
     + udp中只包含两个端口号, 其余的在IP中;
   + 实现UDP在IP首部并不可靠的情况下, 仍能提供可靠的通信传输 

### 传输层其他协议

1. UDP - Lite
   - 当收到的数据校验和出错时, 不一定丢掉数据;
2. DCCP 数据拥塞控制协议
   + 辅助UDP传输的协议, 不能提供可靠性传输
   + 能提供拥塞控制, 确认应答
3. SCTP 流控制传输协议 : 
   + 类型: 是一种对数据可靠性检验的协议
   + 应用: 应用程序之间发送众多较小的消息(数据块); 

## 应用层协议

1. 应用层协议定义:
   + 根据具体应用, 由不同用户研发出来的协议;
   + 应用可以享受**传输层以下**的基础部分, 应用层不需要考虑数据如何传输
2. 在命令的发送和应答
   + 末尾加上换行: CR+LF

### 远程登录

1. TELENT

   + 应用: 登录路由器或交换机进行**相应的设置**.
   + 数据传输模式: 行模式 和 透明模式 (无需加密)
   + tcp连接: 建立一条;

2. SSH

   + 应用: 加密的远程登录系统;
   + 端口转发: 将收到的消息发送给特定的IP地址和端口号码的一种机制
   + TCP连接: 建立三条, 一条加密, 两条不加密
   + SSH的端口号: TCP22

   {% asset_img ssh.png %}

### FTP (File transfer protocol) 文件传输

1. FTP传输的需求
   + 先在**远程登录**的前提下:  计算机之间进行文件传输的协议;
2. FTP工作机制
   + 建立两条TCP连接; TCP21
   + **数据传输**的TCP 和 **控制**的TCP按照相反的方向建立连接
3. FTP连接断开机制
   + 文件传输过程中是不会断开的, 只有当用户长时间未输入命令是才会断开连接;
4. 通过ASCII字符串进行交互处理

### 电子邮件协议

1. 电子邮件的机制:
   + 邮件地址, 数据格式, 发送协议;
2. 数据格式 
   + 通过MIME扩展了数据格式, 不只是单一的文本格式; 

3. SMTP simple mail transfer protocol:
   + 发送电子邮件的协议
   + 引入邮件**服务器**: 发送端与服务器进行通信;
   + TCP25 建立通信链接
     + client : 发送文本请求
     + server: 回复3位数字进行应答
4. POP协议 解决问题
   + 用户需要一上电, 就能接收到协议;
   + POP服务器主动向用户发送链接请求(OK), 用户需要进行验证(user + password)
5. IMAP Internet message access protocol
   + 邮件由服务器进行管理;
   + 用户不用保存到本地就可以进行查看

### WWW  world wide web

1. www 协议作用

   + 将互联网的信息以超文本(文本+ 文本相关内容)进行展示的系统;

2. www万维网的三个概念

   + URI: 访问信息的手段与位置

     + uniform resource identifier
     + URI所表示的组合叫做方案

     {% asset_img uri.png %}

   + HTML: 信息的表现形式

     + 处于表示层
     + 具有纯文本的功能

   + HTTP: 信息转发

     + 当用户输入URI访问时, http就开始工作
     + TCP80 建立连接, 进行请求, 应答, 数据发送
     + http1.0 : 每发送一次就建立断开一次tcp
     + http1.1: 建立一次可以发送多次

### 多媒体通信实现

1. UDP + 呼叫控制协议
2. 呼叫控制协议
   + SIP 协议: 事先解析对方的地址, 呼出对方号码并对所要传输的信息进行处理
   + RTP: 加入表示报文顺序的序列号字段
   + 数字压缩

### 访问目录的协议

1. LDAP lightweight directory access protocol



## 网络安全方式

1. 网络防火墙
2. 加密认证
3. 安全协议 