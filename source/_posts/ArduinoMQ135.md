---
layout: layout
title: ArduinoMQ135
date: 2019-02-17 19:31:44
tags:  
 - arduino 
 - MQ135 
 - OLED 
categories: Product
---

# 口气检测仪项目报告

+ 基于Arduino和MQ135硫化物传感器，实现口气检测

[TOC]



## 1. 总体实现描述

　　人呼出的气体中含有多种痕量挥发性硫化物 , VSCs中硫化氢、甲硫醇和二甲基硫醚的量与口臭的强弱直接相关。这些化合物通常与人体健康及代谢过程相关, 一般分为口腔性和非口腔性, 其中90%来源于口腔，目前监测这种变化的方法目前有: (1) 感官分析法, 即鼻测法; (2) 仪器分析法:气相色谱法、气相色谱质谱联用法、硫化物分析仪 (Halimeter) 法、便携式气相色谱口臭测量仪。本产品主要是根据人体呼出气体中硫化物的浓度进行评判的。  

　　本产品基于Arduino作为主控，通过其模拟通道，结合MQ135传感器，对人体呼出的气体中硫化物的浓度进行采集，（人体口气中的成分如如图）对浓度值进行AD转换，对得到的浓度值进行等级的划分，最后得到用户口气检测的等级，用户通过等级查看小程序的相关建议，从而得到口腔保护的建议。

​						{% asset_img air.png 人体口气中的成分 %}

　　产品设计总的流程框架图如下所示: 

​						{% asset_img frame.png 总体流程图 %}

## 2. 硬件平台搭建

### 2.1 主控Arduino　　

　　主控选择开源硬件Arduino, 使用AD转换的模拟通道进行MQ135的检测，数字通道检测按键的状态，IIC通信方式显示检测过程中的浓度大小。

​						{% asset_img arduino.jpg arduino pro mini %}

### 2.2  传感器 MQ135

　　传感器检测口气中可挥发性硫化物，使用的是电导率较低的二样化锡SnO2，电导率随空气中污染气体浓度的增加而增大，输出一个模拟电压，主控arduino的AD采样值进行采样，并将电压值映射10-1000ppm之间的浓度。

​						{% asset_img MQ135.jpg arduino pro mini %}

### 2.3 显示OLED

　　采用IIC的OLED显示屏，对检测过程中的浓度进行动态显示，并且能显示以前检测的浓度值。

​						{% asset_img oled.jpg arduino pro mini %}	

### 2.4 按键设计

　　按键设计了两部分：

（1）按键一：按下时开始进行口气检测，并在OLED上动态实现；当按键弹起的时候，OLED上固定显示本次检测的最大浓度值和评价等级；

（2）按键二：按下的时候，显示第几次检测，检测的口气浓度值大小和等级。

### 2.5 供电

　　锂电池供电，提供充电模块。

## 3. 软件平台搭建

+ 完整源码：https://github.com/quronghui/Arduino

### 3.1 MQ135浓度采样

　　通过map()函数，对采样的电压值进行映射，得到浓度值。将MQ135输出的电压值（0.1-0.3V -- 4V）映射成浓度（10-1000 ppm）。

```
 long mapping(long x, long in_min, long in_max, long out_min, long out_max);   // 函数的映射
```

### 3.2 存储采样数据

　　通过数据对MQ135每次采样数据的存储，通过排序得到本次检测的最大浓度值，实现按键一（中断0）的功能。

```
void MemoryData();              // 采样数据的存储，存储到数据；
void max();						// 排序得到最大值
```

### 3.3 EEPROM 存储本次检测的等级和浓度值

　　为了用户能查阅以前检测的等级，设计EEPROM函数，对每次检测的等级和浓度值进行保存，当按键二（中断1）按下时后，显示第几次检测，检测的口气浓度值大小和等级，实现按键二的功能。

```
// EEPROM 存储的函数声明
void EepromWriteMaxArray(int EEP_data);        // 写入每次检测到的最大浓度值EEPROM存储器,
void EepromWriteGrade(int grade_data);        // 写入每次检测的等级值
void EepromRead();                            // 从EEPROM存储器读出数据
void EepromClear();                           // 清除EEPROM里面的数据
```

### 3.4 OLED显示

　　采用IIC通信方式，动态显示每次检测的浓度值，以及显示EEPROM 存储的检测值，满足按键一和按键二的需求。

```
      // 对每一次数组的采样值进行OLED显示
      u8g.firstPage();                              //一下是显示实现部分
      do {
        u8g.setFont(u8g_font_fub30);                //设置字体和自号，目前测试字号有fub14,17,20,30
        u8g.setPrintPos(0, 50);                     //显示的位置
        u8g.print(array[i]);                        //显示变量i的值
      } while( u8g.nextPage() );
      delay(500);
```

### 3.5 浓度等级评定

　　浓度等级的评定，主要是根据MQ135的检测结果，和人体承受硫化物浓度的范围进行设定的，根据需求将测量的浓度等级分为5大块，具体设定参考下图。

```
int MQgrade(int temp);                 // 进行等级的评定
int score[] = { <30,                          // grade = 0 未检测
               40,45,50,                      // grade = 1-3 轻微
               55,65,70,                     // grade = 4-6 中度
                75,85,90,                    // grade = 7-9 重度
               > 100                         // grade =100 检测其他物体/或者传感器没有正常连接   
              };   
```

​					{% asset_img H2S.png 人体能承受的H2S的范围 %}	

## 4. 实现效果图

　　实现效果图主要分为以下三部分：（1）动态检测的浓度值；（2）本次检测的最大浓度值和浓度等级；（3）显示EEPROM 存储的检测值，显示第几次检测，检测的口气浓度值大小和等级。

(1) 按键一按下后，显示口气检测仪的动态浓度采样值

{% asset_img 1.jpg 口气检测仪的动态浓度采样值 %}

(2) 按键一弹起后，固定显示本次口气检测的最大浓度值和等级

{% asset_img 2.jpg 人体能承受的H2S的范围 %}

(3) 按键二：按一次，显示第几次检测（T），检测浓度大小（ppm），评价等级（G）

{% asset_img 3.jpg 人体能承受的H2S的范围 %}

## 5. 总结注意

1. MQ135传感器的特性，要求预热足够的时间，40小时以上，检测的浓度值才会稳定。
2. 口气检测仪开始检测时，要进行通电预热，待稳定的时候在进行检测。
3. 由于MQ135的材料特性，每个传感器预热后的初值都不太相同，因此为了检测的灵敏度要求，需要手动调整一下代码。

## 6. 价格

|      物料 / 个       | 价格 / 元 |                             链接                             |
| :------------------: | :-------: | :----------------------------------------------------------: |
|   Arduino Pro Mini   |   10.9    | [智能创客科技](https://item.taobao.com/item.htm?spm=a1z09.2.0.0.17792e8dX05esy&id=570526032936&_u=i23c070s6e66) |
|        MQ135         |   9.23    | [risym旗舰店](https://detail.tmall.com/item.htm?id=13302081252&spm=a1z09.2.0.0.17792e8dX05esy&_u=i23c070sc980) |
|         OLED         |   22.99   | [telesky旗舰店](https://detail.tmall.com/item.htm?id=525584032584&spm=a1z09.2.0.0.17792e8dX05esy&_u=i23c070s808d) |
|       PCB制板        |     5     |                            嘉利创                            |
|        锂电池        |    13     | [海兄弟锂电池 ](https://item.taobao.com/item.htm?id=571443525847&ali_refid=a3_420434_1006:1151968984:N:%E9%94%82%E7%94%B5%E6%B1%A0:2a581f477100d75e1049e99f43f59ee6&ali_trackid=1_2a581f477100d75e1049e99f43f59ee6&spm=a230r.1.1957635.7) |
| 其他电容电阻和接插件 |           |                                                              |

