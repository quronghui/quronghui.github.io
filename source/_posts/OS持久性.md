---
layout: post
title: OS持久性
date: 2019-07-24 15:29:42
categories: [Operate System]
tags: 持久性
---

# 持久性

1. 抽象模型
   + 采用什么样的方式, 让数据(**桃子**)保存的时间长久;
2. 持久性针对的对象:
   + 数据
3. 硬件中断的实现过程: 
   - 设备准备好自身的工作 --->  发出硬件中断 ---> CPU 执行OS 中预先定义的中断服务例程ISR(interrupt server routine) / 中断处理程序(interrupt handler) ---> 返回唤醒等待的I/O进程继续执行.
4. 调度策略
   + 调度策略有哪些: 对影响因素的不同侧重和形成的;
   + 不用去记忆调度策略, 反而应该知道影响因素; 

## I/O 设备 -- 数据交互

### **问题一:** OS 如何与I/O设备进行交互的? 

1. 将设备的硬件接口纳入到OS;

   + **封装**设备驱动程序(OS中的一部分软件): 完成底层操作;

   {% asset_img file_system.jpg %}

   + 驱动程序中充满了内核;

### 标准硬件

1. 原型系统架构的分层模型:

   + 物理布局和造价成本决定的分层;

   {% asset_img system.jpg %}

2. 标准硬件

   + 硬件接口: 寄存器 ( status + data + command register )
     + 操作系统控制设备工作的接口
   + 内部结构: CPU + Memory + 芯片
     + 完成具体接口的工作;

### 标准协议 

+ OS 对硬件接口的**statue register** 进行**polling**
+ OS下发数据到**data register**
  + CPU参与数据移动: 称之为PIO(programmer I/O)
+ OS 下发**command**, 进行命令的执行

1. **问题一** : 如何减polling中cpu的开销?
   + **硬件中断实现:**
   + 优势: 中断允许计算与I/O重叠; (CPU可以执行其他进程)
   + **中断改进**
     + polling + interrupt: 先轮询一段时间, 时间过程的话就进行中断; ( CPU/IO 交换很快 )
     + 合并: 抛出中断时, 等待一段时间;
2. **问题二**: 如何实现高效的数据传输?
   +  增加硬件设备:  DMA (direct memory access) 
     + 协调内存和设备间的数据交互, 不许哦啊CPU介入;
3. **问题三**: OS的交互指令是什么?
   + 方法一: I/O指令 -- 特权指令
     + OS是唯一能与硬件设备直接交互的实体; 
   + 方法二: 内存映射I/O
     + 硬件将设备寄存器作为内存地址提供;

## 硬件存储设备

+ 设备: 长久的保存数据, 用户更关心的是数据
+ 内存: 断电后内容会丢失;

### 磁盘驱动器 

1. 硬件接口:

   + 大量的**扇区块**( 512 byte ), 每个块可以进行读取和写入;

2. 几何扇区如何进行数据存储

   + 磁性: 对磁盘引入磁性, 进行数据永久保存
   + 磁道: 一个同心圆;
   + 磁头: 用于在磁道上读取或者写入数据的;
   + : 磁道 **逆时针**旋转, 到了磁头下面, 进行数据操作

3. 磁盘的特性

   + 单磁道: 旋转延时;
   + 多磁道: 寻道时间
   + 外磁道比内磁道有更多的存储空间;
   + 缓存cache: 磁道缓存区

   {% asset_img disk.jpg %}

4. **问题一:** 数据是如何与磁盘进行交互的?

   + 磁头通过**寻道**移动到不同的磁道上, 磁盘的逆时针旋转, 将不同的**扇区块**移动到磁头下面, 从而完成数据交互;

5. **问题二** : 数据交互的时间?

   ```
   T(I/O) = T(寻道time) + T(旋转) + T(数据移动)
   ```

6. **问题三**: 磁盘调度策略 -- 降低数据交互时间

   + 根据不同的影响因素, 有不同的策略;

   + **最短寻道时间优先**
   + **最短定位时间优先**

### RAID (廉价冗余磁盘阵列)

1. RAID (Redundant Array of Inexpensive Disks)

   + 将大量的独立磁盘扩充称更大, 更可靠的单一实体;
   + **透明性:** 使用RAID替换磁盘, 不用考虑跟换软件驱动;

2. RAID 的特性

   + 性能: 加快I/O读取时间;
   + 容量: 扩充磁盘
   + 可靠性: 冗余进行数据的物理备份

3. 硬件接口和内部

   + 硬件接口: 线性的块数组, 每个块都可以通过文件系统进行读取和写入;
   + 内部: 专业的计算机, 有一个CPU + Memory + 磁盘

4. **问题一** 如何设计RAID?

   + 方法: 根据对RAID的特性的不同偏重, 设计不同的RAID;

   

   | RAID的类型        | 特性                                                         |
   | ----------------- | ------------------------------------------------------------ |
   | RAID 0 级: 条带化 | 无冗余, 全部用来存储,  容量大                                |
   | RAID 1 级: 镜像   | 对每个逻辑块, 保留两个物理副本; 只有一半的容量, 但是更可靠了 |

   

